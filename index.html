<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte OOCC - Insp. Estructura</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilos extra para simular las secciones del Excel */
        .excel-section {
            border: 1px solid #cbd5f5;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .excel-header {
            background-color: #3b82f6; /* Azul similar al Excel */
            color: white;
            padding: 0.5rem 1rem;
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        .excel-body {
            padding: 1rem;
            background-color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>Generador de Reportes OOCC</h1>
        <p>Llenado Autom√°tico: Hoja "Insp. Estructura"</p>
    </header>

    <main>
        <form id="reporte-form">
            
            <!-- SECCI√ìN I: DATOS DEL COOPERADOR -->
            <div class="excel-section">
                <div class="excel-header">I. DATOS DEL COOPERADOR (PERSONAL 01)</div>
                <div class="excel-body">
                    <div class="form-grid">
                        <label>Nombre Personal 01
                            <input type="text" name="cooperador_nombre" placeholder="Ej: Juan P√©rez" />
                        </label>
                        <label>Cargo
                            <input type="text" name="cooperador_cargo" placeholder="Ej: T√©cnico" />
                        </label>
                        <label>Empresa
                            <input type="text" name="cooperador_empresa" placeholder="Ej: Contratista SAC" />
                        </label>
                        <label>DNI
                            <input type="text" name="cooperador_dni" placeholder="Ej: 4589..." />
                        </label>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN II: DATOS DEL PROYECTO Y SITE -->
            <div class="excel-section">
                <div class="excel-header">II. DATOS DEL PROYECTO Y SITE</div>
                <div class="excel-body">
                    <div class="form-grid">
                        <label>Nombre Site (E20)
                            <input type="text" name="site_nombre" placeholder="Ej: TORRE LIMA" required />
                        </label>
                        <label>Proyecto (G20)
                            <input type="text" name="site_proyecto" placeholder="Ej: 5G - Rollout" />
                        </label>
                        <label>Direcci√≥n (E22)
                            <input type="text" name="site_direccion" placeholder="Av. Siempre Viva 123" />
                        </label>
                        <label>Dpto., Prov., Distrito (C24)
                            <input type="text" name="site_distrito" placeholder="Lima, Lima, Miraflores" />
                        </label>
                        <label>Tipo de Sitio (G24)
                            <input type="text" name="site_tipo" placeholder="Ej: Rooftop / Greenfield" />
                        </label>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN III: DATOS DEL INSPECTOR -->
            <div class="excel-section">
                <div class="excel-header">III. DATOS DEL INSPECTOR</div>
                <div class="excel-body">
                    <div class="form-grid">
                        <label>Nombre Inspector (Personal 01)
                            <input type="text" name="inspector_nombre" placeholder="Ej: Ing. Anthony Chile" required />
                        </label>
                        <label>Cargo
                            <input type="text" name="inspector_cargo" placeholder="Ej: Supervisor Senior" />
                        </label>
                        <label>Empresa
                            <input type="text" name="inspector_empresa" placeholder="Ej: Entel / Consultora" />
                        </label>
                        <label>Fecha Inicio Supervisi√≥n (F30)
                            <input type="date" name="fecha_inspeccion" required />
                        </label>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN IV: PRUEBA DE CHECKLIST (Cimentaci√≥n) -->
            <!-- Solo ponemos 3 ejemplos para probar la l√≥gica -->
            <div class="excel-section">
                <div class="excel-header">IV. CHECKLIST (CIMENTACI√ìN - CONCRETO)</div>
                <div class="excel-body">
                    <p style="font-size: 0.8rem; margin-bottom:1rem; color:gray;">Ejemplo de preguntas (1-3):</p>
                    <div class="form-grid">
                        <label>1. Fisuras en concreto (SI/NO)
                            <select name="check_1">
                                <option value="">- Seleccionar -</option>
                                <option value="SI">SI</option>
                                <option value="NO">NO</option>
                                <option value="NA">NA</option>
                            </select>
                        </label>
                        <label>2. Desprendimientos (SI/NO)
                            <select name="check_2">
                                <option value="">- Seleccionar -</option>
                                <option value="SI">SI</option>
                                <option value="NO">NO</option>
                                <option value="NA">NA</option>
                            </select>
                        </label>
                        <label>3. Humedad (SI/NO)
                            <select name="check_3">
                                <option value="">- Seleccionar -</option>
                                <option value="SI">SI</option>
                                <option value="NO">NO</option>
                                <option value="NA">NA</option>
                            </select>
                        </label>
                    </div>
                </div>
            </div>

            <!-- FOTOS -->
            <div class="card">
                <h2>üì∏ Evidencia Fotogr√°fica</h2>
                <div class="form-grid">
                    <label>Foto Principal (Hoja 4 - B11)
                        <input type="file" name="foto" accept="image/*" required />
                    </label>
                    <label>Descripci√≥n de la Foto
                        <input type="text" name="descripcionFoto" placeholder="Descripci√≥n breve..." />
                    </label>
                </div>
                <br>
                <button type="submit" class="primary" id="btnGenerar" style="width: 100%;">Generar Reporte Excel</button>
            </div>

            <div id="form-status" class="status text-center"></div>
        </form>
    </main>

    <script>
        document.getElementById('reporte-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnGenerar');
            const statusDiv = document.getElementById('form-status');
            
            // Recolectar datos
            const formData = new FormData(e.target);

            // UI Loading
            btn.disabled = true;
            btn.textContent = "‚è≥ Procesando Excel...";
            statusDiv.textContent = "Inyectando datos en la plantilla...";
            statusDiv.className = "status";

            try {
                // CAMBIAR POR TU URL REAL EN RENDER
                const URL_BACKEND = "https://backend-reportes-excel.onrender.com/generar-reporte"; 
                
                const response = await fetch(URL_BACKEND, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error(await response.text());

                // Descargar
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Reporte_${formData.get('site_nombre') || 'OOCC'}.xlsx`;
                document.body.appendChild(a);
                a.click();
                a.remove();

                statusDiv.textContent = "‚úÖ ¬°Reporte generado correctamente!";
                statusDiv.classList.add('success');

            } catch (error) {
                console.error(error);
                statusDiv.textContent = "‚ùå Error: " + error.message;
                statusDiv.classList.add('error');
            } finally {
                btn.disabled = false;
                btn.textContent = "Generar Reporte Excel";
            }
        });
    </script>
</body>
</html>