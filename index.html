<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes AENOR - Inspecci√≥n Estructural</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* SLIDE BIENVENIDA */
        .welcome-slide {
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .welcome-slide h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .welcome-slide .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 40px;
        }

        .welcome-slide .author {
            font-size: 1rem;
            opacity: 0.8;
            font-style: italic;
        }

        /* HEADER DEL FORMULARIO */
        .form-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .form-header h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .form-header .step-indicator {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* PROGRESS BAR */
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.3);
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }

        /* CONTENIDO DEL SLIDE */
        .slide {
            display: none;
            padding: 40px;
            animation: fadeIn 0.4s ease;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* PERSONAL ROW */
        .personal-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .personal-row label {
            font-weight: 600;
            color: #667eea;
            align-self: center;
        }

        /* QUESTION ROW */
        .question-row {
            display: grid;
            grid-template-columns: 40px 2fr 120px 120px 1.5fr;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .question-row .q-number {
            font-weight: bold;
            color: #667eea;
            text-align: center;
        }

        .question-row .q-text {
            color: #374151;
        }

        .question-row select {
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
        }

        .question-row input[type="text"] {
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
        }

        /* RESULTADO BOX */
        .resultado-box {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .resultado-box h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-card .label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .calificacion-final {
            text-align: center;
            font-size: 3.5rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .paralizacion-alert {
            background: #ef4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            display: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* BOTONES */
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e5e7eb;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* STATUS MESSAGE */
        .status-msg {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .status-msg.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-msg.error {
            background: #fee2e2;
            color: #991b1b;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .welcome-slide h1 {
                font-size: 2.5rem;
            }

            .personal-row {
                grid-template-columns: 1fr;
            }

            .question-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- SLIDE 0: BIENVENIDA -->
    <div id="slide-0" class="slide active">
        <div class="welcome-slide">
            <h1>üèóÔ∏è REPORTES AENOR</h1>
            <p class="subtitle">Sistema de Inspecci√≥n Estructural</p>
            <p class="author">by Anthony Chilet üöÄ</p>
            <button class="btn btn-primary" onclick="nextSlide()" style="margin-top: 40px; max-width: 300px; margin-left: auto; margin-right: auto;">
                Comenzar Inspecci√≥n ‚Üí
            </button>
        </div>
    </div>

    <!-- SLIDES DEL FORMULARIO -->
    <form id="reporte-form" enctype="multipart/form-data">
        
        <!-- SLIDE 1: DATOS DEL COOPERADOR -->
        <div id="slide-1" class="slide">
            <div class="form-header">
                <h2>I. DATOS DEL COOPERADOR</h2>
                <p class="step-indicator">Paso 1 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 16.66%"></div>
            </div>

            <div style="padding: 40px;">
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="razon_social">Raz√≥n Social (E11)</label>
                            <input type="text" id="razon_social" name="razon_social">
                        </div>
                        <div class="form-group">
                            <label for="ruc">RUC (T11)</label>
                            <input type="text" id="ruc" name="ruc">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Personal de Inspecci√≥n</h3>
                    
                    <div class="personal-row">
                        <input type="text" name="personal_01_nombre" placeholder="Nombre">
                        <input type="text" name="personal_01_cargo" placeholder="Cargo">
                        <input type="text" name="personal_01_empresa" placeholder="Empresa">
                        <input type="text" name="personal_01_dni" placeholder="DNI">
                    </div>

                    <div class="personal-row">
                        <input type="text" name="personal_01_nombre_2" placeholder="Nombre">
                        <input type="text" name="personal_01_cargo_2" placeholder="Cargo">
                        <input type="text" name="personal_01_empresa_2" placeholder="Empresa">
                        <input type="text" name="personal_01_dni_2" placeholder="DNI">
                    </div>

                    <div class="personal-row">
                        <input type="text" name="personal_01_nombre_3" placeholder="Nombre">
                        <input type="text" name="personal_01_cargo_3" placeholder="Cargo">
                        <input type="text" name="personal_01_empresa_3" placeholder="Empresa">
                        <input type="text" name="personal_01_dni_3" placeholder="DNI">
                    </div>

                    <div class="personal-row">
                        <input type="text" name="personal_01_nombre_4" placeholder="Nombre">
                        <input type="text" name="personal_01_cargo_4" placeholder="Cargo">
                        <input type="text" name="personal_01_empresa_4" placeholder="Empresa">
                        <input type="text" name="personal_01_dni_4" placeholder="DNI">
                    </div>

                    <div class="personal-row">
                        <input type="text" name="personal_01_nombre_5" placeholder="Nombre">
                        <input type="text" name="personal_01_cargo_5" placeholder="Cargo">
                        <input type="text" name="personal_01_empresa_5" placeholder="Empresa">
                        <input type="text" name="personal_01_dni_5" placeholder="DNI">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextSlide()">Siguiente ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- SLIDE 2: DATOS DEL PROYECTO -->
        <div id="slide-2" class="slide">
            <div class="form-header">
                <h2>II. DATOS DEL PROYECTO Y SITE</h2>
                <p class="step-indicator">Paso 2 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 33.33%"></div>
            </div>

            <div style="padding: 40px;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nombre_site">Nombre Site (E20) *</label>
                        <input type="text" id="nombre_site" name="nombre_site" required>
                    </div>
                    <div class="form-group">
                        <label for="proyecto">Proyecto (L20)</label>
                        <input type="text" id="proyecto" name="proyecto">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="solucion">Soluci√≥n (T20)</label>
                        <input type="text" id="solucion" name="solucion">
                    </div>
                    <div class="form-group">
                        <label for="prioridad">Prioridad (E21)</label>
                        <input type="text" id="prioridad" name="prioridad">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="actividad_campo">Actividad en Campo (L21)</label>
                        <input type="text" id="actividad_campo" name="actividad_campo">
                    </div>
                    <div class="form-group">
                        <label for="n_mop">N¬∞ MOP (T21)</label>
                        <input type="text" id="n_mop" name="n_mop">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="direccion">Direcci√≥n (E22)</label>
                        <input type="text" id="direccion" name="direccion">
                    </div>
                    <div class="form-group">
                        <label for="actividad_mop">Actividad en MOP (L22)</label>
                        <input type="text" id="actividad_mop" name="actividad_mop">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="n_contrato">N¬∞ Contrato (T22)</label>
                        <input type="text" id="n_contrato" name="n_contrato">
                    </div>
                    <div class="form-group">
                        <label for="acceso_contingente">Acceso Contingente (E23)</label>
                        <input type="text" id="acceso_contingente" name="acceso_contingente">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="comentarios_proyecto">Comentarios (L23)</label>
                        <input type="text" id="comentarios_proyecto" name="comentarios_proyecto">
                    </div>
                    <div class="form-group">
                        <label for="distrito">Dpto., Prov., Distrito (E24)</label>
                        <input type="text" id="distrito" name="distrito">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipo_sitio">Tipo de Sitio (L24)</label>
                        <input type="text" id="tipo_sitio" name="tipo_sitio">
                    </div>
                    <div class="form-group">
                        <label for="servicio_inspeccionado">Servicio Inspeccionado (T24)</label>
                        <input type="text" id="servicio_inspeccionado" name="servicio_inspeccionado">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextSlide()">Siguiente ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- SLIDE 3: DATOS DEL INSPECTOR -->
        <div id="slide-3" class="slide">
            <div class="form-header">
                <h2>III. DATOS DEL INSPECTOR</h2>
                <p class="step-indicator">Paso 3 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 50%"></div>
            </div>

            <div style="padding: 40px;">
                <div class="form-section">
                    <h3>Inspector 1</h3>
                    <div class="personal-row">
                        <input type="text" name="inspector_01_nombre" placeholder="Nombre">
                        <input type="text" name="inspector_01_cargo" placeholder="Cargo">
                        <input type="text" name="inspector_01_empresa" placeholder="Empresa">
                        <input type="text" name="inspector_01_dni" placeholder="DNI">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Inspector 2</h3>
                    <div class="personal-row">
                        <input type="text" name="inspector_02_nombre" placeholder="Nombre">
                        <input type="text" name="inspector_02_cargo" placeholder="Cargo">
                        <input type="text" name="inspector_02_empresa" placeholder="Empresa">
                        <input type="text" name="inspector_02_dni" placeholder="DNI">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fecha_inicio">Fecha Inicio Supervisi√≥n (F30) *</label>
                        <input type="date" id="fecha_inicio" name="fecha_inicio" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha_fin">Fecha Fin Supervisi√≥n (R30)</label>
                        <input type="date" id="fecha_fin" name="fecha_fin">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextSlide()">Siguiente ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- SLIDE 4: CHECKLIST (45 PREGUNTAS) -->
        <div id="slide-4" class="slide">
            <div class="form-header">
                <h2>IV. CHECKLIST DE VERIFICACI√ìN</h2>
                <p class="step-indicator">Paso 4 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 66.66%"></div>
            </div>

            <div style="padding: 40px; max-height: 600px; overflow-y: auto;">
                <p style="color: #6b7280; margin-bottom: 20px;">
                    <strong>Instrucciones:</strong> Respuesta (SI/NO/NA) | Paralizaci√≥n (SI/NO) | Comentarios
                </p>

                <!-- Las 45 preguntas aqu√≠ (por brevedad, incluyo las primeras) -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0;">Cimentaci√≥n - Condiciones del Concreto</h3>
                
                <div class="question-row">
                    <div class="q-number">1</div>
                    <div class="q-text">Presenta fisuras en el concreto</div>
                    <select name="p_concreto_1"><option value="NO" selected>NO</option><option value="SI">SI</option><option value="NA">NA</option></select>
                    <select name="p_concreto_1_paralizacion"><option value="NO" selected>NO</option><option value="SI">SI</option></select>
                    <input type="text" name="p_concreto_1_comentario" placeholder="Comentario">
                </div>

                <div class="question-row">
                    <div class="q-number">2</div>
                    <div class="q-text">Presenta desprendimientos</div>
                    <select name="p_concreto_2"><option value="NO" selected>NO</option><option value="SI">SI</option><option value="NA">NA</option></select>
                    <select name="p_concreto_2_paralizacion"><option value="NO" selected>NO</option><option value="SI">SI</option></select>
                    <input type="text" name="p_concreto_2_comentario" placeholder="Comentario">
                </div>

                <div class="question-row">
                    <div class="q-number">3</div>
                    <div class="q-text">Presenta humedad</div>
                    <select name="p_concreto_3"><option value="NO" selected>NO</option><option value="SI">SI</option><option value="NA">NA</option></select>
                    <select name="p_concreto_3_paralizacion"><option value="NO" selected>NO</option><option value="SI">SI</option></select>
                    <input type="text" name="p_concreto_3_comentario" placeholder="Comentario">
                </div>

                <!-- Contin√∫a con las otras 42 preguntas... (las incluir√© al final) -->
                <p style="text-align: center; color: #6b7280; margin: 30px 0;">
                    [Aqu√≠ van las 42 preguntas restantes - Las agregar√© en la versi√≥n final]
                </p>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextSlide()">Siguiente ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- SLIDE 5: RESULTADOS Y FOTO -->
        <div id="slide-5" class="slide">
            <div class="form-header">
                <h2>V. RESULTADOS Y REPORTE FOTOGR√ÅFICO</h2>
                <p class="step-indicator">Paso 5 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 83.33%"></div>
            </div>

            <div style="padding: 40px;">
                <!-- Alerta de paralizaci√≥n -->
                <div id="paralizacion-alert" class="paralizacion-alert">
                    ‚ö†Ô∏è SE DETECT√ì PARALIZACI√ìN EN UNA O M√ÅS PREGUNTAS
                </div>

                <!-- Resultados calculados -->
                <div class="resultado-box">
                    <h3>üìä Resultados de la Inspecci√≥n</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="label">Respuestas SI</div>
                            <div class="value" id="total-si">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Respuestas NO</div>
                            <div class="value" id="total-no">45</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">No Aplica (NA)</div>
                            <div class="value" id="total-na">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Preguntas Aplicables</div>
                            <div class="value" id="preguntas-aplicables">45</div>
                        </div>
                    </div>

                    <div class="calificacion-final">
                        <div style="font-size: 1.2rem; opacity: 0.9;">Calificaci√≥n Lograda</div>
                        <div id="calificacion-porcentaje">100.00%</div>
                    </div>
                </div>

                <!-- Campos ocultos -->
                <input type="hidden" name="total_si" id="total_si_hidden" value="0">
                <input type="hidden" name="total_no" id="total_no_hidden" value="45">
                <input type="hidden" name="total_na" id="total_na_hidden" value="0">
                <input type="hidden" name="preguntas_aplicables" id="preguntas_aplicables_hidden" value="45">
                <input type="hidden" name="calificacion_lograda" id="calificacion_lograda_hidden" value="100.00">
                <input type="hidden" name="tiene_paralizacion" id="tiene_paralizacion_hidden" value="NO">

                <!-- Reporte fotogr√°fico -->
                <div class="form-section">
                    <h3>üì∏ Reporte Fotogr√°fico</h3>
                    <div class="form-group">
                        <label for="foto">Adjuntar Foto (Obligatorio) *</label>
                        <input type="file" id="foto" name="foto" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="descripcionFoto">Descripci√≥n de la foto</label>
                        <textarea id="descripcionFoto" name="descripcionFoto" rows="3" placeholder="Describe brevemente la fotograf√≠a adjunta"></textarea>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextSlide()">Finalizar ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- SLIDE 6: GENERACI√ìN DEL REPORTE -->
        <div id="slide-6" class="slide">
            <div class="form-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <h2>‚úÖ GENERAR REPORTE EXCEL</h2>
                <p class="step-indicator">Paso 6 de 6</p>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" style="width: 100%; background: #10b981;"></div>
            </div>

            <div style="padding: 60px 40px; text-align: center;">
                <h3 style="color: #667eea; font-size: 1.8rem; margin-bottom: 20px;">
                    üéâ ¬°Formulario Completado!
                </h3>
                <p style="color: #6b7280; font-size: 1.1rem; margin-bottom: 40px;">
                    Todos los datos han sido registrados correctamente.<br>
                    Haz clic en el bot√≥n para generar y descargar tu reporte en Excel.
                </p>

                <button type="submit" id="btnSubmit" class="btn btn-primary" style="max-width: 400px; padding: 20px 40px; font-size: 1.2rem;">
                    üöÄ Generar Reporte Excel
                </button>

                <div id="status-msg" class="status-msg"></div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="prevSlide()">‚Üê Anterior</button>
                </div>
            </div>
        </div>

    </form>
</div>

<script>
let currentSlide = 0;
const totalSlides = 7; // 0-6

// Navegaci√≥n entre slides
function nextSlide() {
    if (currentSlide < totalSlides - 1) {
        // Validar campos requeridos del slide actual
        const currentSlideEl = document.getElementById(`slide-${currentSlide}`);
        if (currentSlideEl && currentSlideEl.querySelector) {
            const requiredInputs = currentSlideEl.querySelectorAll('input[required], select[required]');
            let allValid = true;
            
            requiredInputs.forEach(input => {
                if (!input.value || (input.type === 'file' && !input.files.length)) {
                    allValid = false;
                    input.style.borderColor = '#ef4444';
                } else {
                    input.style.borderColor = '#e5e7eb';
                }
            });

            if (!allValid && currentSlide > 0) {
                alert('‚ö†Ô∏è Por favor completa todos los campos obligatorios (*)');
                return;
            }
        }

        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide++;
        document.getElementById(`slide-${currentSlide}`).classList.add('active');
        window.scrollTo(0, 0);

        // Calcular al llegar al slide de resultados
        if (currentSlide === 5) {
            calcularCalificacion();
        }
    }
}

function prevSlide() {
    if (currentSlide > 0) {
        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide--;
        document.getElementById(`slide-${currentSlide}`).classList.add('active');
        window.scrollTo(0, 0);
    }
}

// Lista de todas las preguntas
const preguntas = [
    'p_concreto_1', 'p_concreto_2', 'p_concreto_3',
    'p_anclaje_1', 'p_anclaje_2', 'p_anclaje_3',
    'p_base_1', 'p_base_2', 'p_base_3', 'p_base_4',
    'p_conexion_1', 'p_conexion_2', 'p_conexion_3', 'p_conexion_4', 'p_conexion_5', 'p_conexion_6',
    'p_corrosion_1', 'p_corrosion_2', 'p_corrosion_3', 'p_corrosion_4', 'p_corrosion_5',
    'p_corrosion_6', 'p_corrosion_7', 'p_corrosion_8', 'p_corrosion_9', 'p_corrosion_10',
    'p_corrosion_11', 'p_corrosion_12', 'p_corrosion_13', 'p_corrosion_14', 'p_corrosion_15',
    'p_corrosion_16', 'p_corrosion_17', 'p_corrosion_18',
    'p_alineamiento_1', 'p_alineamiento_2', 'p_alineamiento_3', 'p_alineamiento_4', 'p_alineamiento_5',
    'p_adicional_1', 'p_adicional_2', 'p_adicional_3', 'p_adicional_4', 'p_adicional_5', 'p_adicional_6'
];

// Calcular calificaci√≥n
function calcularCalificacion() {
    let totalSi = 0;
    let totalNo = 0;
    let totalNa = 0;
    let tieneParalizacion = false;

    preguntas.forEach(pregunta => {
        const select = document.querySelector(`select[name="${pregunta}"]`);
        const paralizacionSelect = document.querySelector(`select[name="${pregunta}_paralizacion"]`);
        
        if (select) {
            const valor = select.value;
            if (valor === 'SI') totalSi++;
            else if (valor === 'NO') totalNo++;
            else if (valor === 'NA') totalNa++;
        }

        if (paralizacionSelect && paralizacionSelect.value === 'SI') {
            tieneParalizacion = true;
        }
    });

    const preguntasAplicables = 45 - totalNa;
    const calificacion = preguntasAplicables > 0 ? (totalNo / preguntasAplicables) * 100 : 0;

    // Actualizar UI
    document.getElementById('total-si').textContent = totalSi;
    document.getElementById('total-no').textContent = totalNo;
    document.getElementById('total-na').textContent = totalNa;
    document.getElementById('preguntas-aplicables').textContent = preguntasAplicables;
    document.getElementById('calificacion-porcentaje').textContent = calificacion.toFixed(2) + '%';

    // Alerta de paralizaci√≥n
    document.getElementById('paralizacion-alert').style.display = tieneParalizacion ? 'block' : 'none';

    // Actualizar campos ocultos
    document.getElementById('total_si_hidden').value = totalSi;
    document.getElementById('total_no_hidden').value = totalNo;
    document.getElementById('total_na_hidden').value = totalNa;
    document.getElementById('preguntas_aplicables_hidden').value = preguntasAplicables;
    document.getElementById('calificacion_lograda_hidden').value = calificacion.toFixed(2);
    document.getElementById('tiene_paralizacion_hidden').value = tieneParalizacion ? 'SI' : 'NO';

    // Color din√°mico
    const porcentajeEl = document.getElementById('calificacion-porcentaje');
    if (calificacion >= 90) {
        porcentajeEl.style.color = 'white';
    } else if (calificacion >= 70) {
        porcentajeEl.style.color = '#fbbf24';
    } else {
        porcentajeEl.style.color = '#fee2e2';
    }
}

// Env√≠o del formulario
document.getElementById('reporte-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const btn = document.getElementById('btnSubmit');
    const statusDiv = document.getElementById('status-msg');
    const formData = new FormData(e.target);

    // Validar foto
    if (!formData.get('foto').name) {
        alert("‚ö†Ô∏è Debes subir una foto obligatoriamente.");
        return;
    }

    btn.disabled = true;
    btn.textContent = "‚è≥ Generando Excel...";
    statusDiv.style.display = 'block';
    statusDiv.className = 'status-msg';
    statusDiv.textContent = "Procesando datos y generando reporte...";

    try {
        const URL_BACKEND = "https://backend-reportes-excel.onrender.com/generar-reporte";

        const response = await fetch(URL_BACKEND, {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || `Error en el servidor: ${response.status}`);
        }

        // Descargar archivo
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Reporte_${formData.get('nombre_site') || 'OOCC'}.xlsx`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        statusDiv.className = 'status-msg success';
        statusDiv.textContent = "‚úÖ ¬°Reporte generado y descargado exitosamente!";

    } catch (error) {
        console.error(error);
        statusDiv.className = 'status-msg error';
        statusDiv.textContent = "‚ùå Error: " + error.message;
    } finally {
        btn.disabled = false;
        btn.textContent = "üöÄ Generar Reporte Excel";
    }
});

// Escuchar cambios en preguntas para recalcular
preguntas.forEach(pregunta => {
    const select = document.querySelector(`select[name="${pregunta}"]`);
    const paralizacionSelect = document.querySelector(`select[name="${pregunta}_paralizacion"]`);
    
    if (select) select.addEventListener('change', calcularCalificacion);
    if (paralizacionSelect) paralizacionSelect.addEventListener('change', calcularCalificacion);
});
</script>

</body>
</html>
