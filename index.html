<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inspecci√≥n Estructural - Entel</title>
    <style>
        /* Estilos b√°sicos para el formato simple de la plantilla */
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { max-width: 800px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        input[type="text"], input[type="date"], select { 
            width: 100%; padding: 8px; margin: 5px 0 10px 0; display: inline-block; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; 
        }
        button { 
            background-color: #4CAF50; color: white; padding: 10px 15px; margin: 8px 0; border: none; border-radius: 4px; cursor: pointer; width: 100%; 
        }
        button:hover { background-color: #45a049; }
        
        /* Estilos para las preguntas (manteniendo el formato de tabla/columna simple) */
        .question-row { display: flex; align-items: center; margin-bottom: 5px; }
        .question-row label.q-number { width: 5%; font-weight: bold; }
        .question-row label.q-text { width: 45%; }
        .question-row select { width: 12%; margin: 0 5px; padding: 5px; }
        .question-row input[type="text"] { width: 26%; margin: 0 5px; padding: 5px; }

        /* Estilos para el personal, alineando los 4 inputs de cada persona */
        .personal-row { display: flex; margin-bottom: 5px; }
        .personal-row label { width: 15%; font-weight: bold; align-self: center; }
        .personal-row input { width: 21%; margin-right: 1%; } 

    </style>
</head>
<body>

<form id="reporte-form">
    <h1>Reporte de Inspecci√≥n Estructural</h1>
    
    <hr>
    
    <h2>I. DATOS DEL COOPERADOR</h2>
    
    <label for="razon_social">Raz√≥n Social (E11):</label>
    <input type="text" id="razon_social" name="razon_social"><br>
    
    <label for="ruc">RUC (T11):</label>
    <input type="text" id="ruc" name="ruc"><br>

    <h3>Personal de Inspecci√≥n</h3>
    
    <div class="personal-row">
        <label>Personal 01:</label>
        <input type="text" name="personal_01_nombre" placeholder="Nombre (D12)">
        <input type="text" name="personal_01_cargo" placeholder="Cargo (H12)">
        <input type="text" name="personal_01_empresa" placeholder="Empresa (O12)">
        <input type="text" name="personal_01_dni" placeholder="DNI (T12)">
    </div>

    <div class="personal-row">
        <label>Personal 02:</label>
        <input type="text" name="personal_01_nombre_2" placeholder="Nombre (D13)">
        <input type="text" name="personal_01_cargo_2" placeholder="Cargo (H13)">
        <input type="text" name="personal_01_empresa_2" placeholder="Empresa (O13)">
        <input type="text" name="personal_01_dni_2" placeholder="DNI (T13)">
    </div>

    <div class="personal-row">
        <label>Personal 03:</label>
        <input type="text" name="personal_01_nombre_3" placeholder="Nombre (D14)">
        <input type="text" name="personal_01_cargo_3" placeholder="Cargo (H14)">
        <input type="text" name="personal_01_empresa_3" placeholder="Empresa (O14)">
        <input type="text" name="personal_01_dni_3" placeholder="DNI (T14)">
    </div>

    <div class="personal-row">
        <label>Personal 04:</label>
        <input type="text" name="personal_01_nombre_4" placeholder="Nombre (D15)">
        <input type="text" name="personal_01_cargo_4" placeholder="Cargo (H15)">
        <input type="text" name="personal_01_empresa_4" placeholder="Empresa (O15)">
        <input type="text" name="personal_01_dni_4" placeholder="DNI (T15)">
    </div>

    <div class="personal-row">
        <label>Personal 05:</label>
        <input type="text" name="personal_01_nombre_5" placeholder="Nombre (D16)">
        <input type="text" name="personal_01_cargo_5" placeholder="Cargo (H16)">
        <input type="text" name="personal_01_empresa_5" placeholder="Empresa (O16)">
        <input type="text" name="personal_01_dni_5" placeholder="DNI (T16)">
    </div>
    
    <hr>

    <h2>II. DATOS DEL PROYECTO Y SITE</h2>
    <label for="nombre_site">Nombre Site (E20):</label>
    <input type="text" id="nombre_site" name="nombre_site" required><br>
    
    <label for="prioridad">Prioridad (E21):</label>
    <input type="text" id="prioridad" name="prioridad"><br>
    
    <label for="direccion">Direcci√≥n (E22):</label>
    <input type="text" id="direccion" name="direccion"><br>
    
    <label for="distrito">Distrito/Prov/Dpto (E24):</label>
    <input type="text" id="distrito" name="distrito"><br>
    
    <label for="tipo_sitio">Tipo de Sitio (L24):</label>
    <input type="text" id="tipo_sitio" name="tipo_sitio"><br>

    <hr>

    <h2>III. DATOS DEL INSPECTOR</h2>
    <input type="text" name="inspector_nombre" placeholder="Nombre Inspector (D28)"><br>
    <input type="text" name="inspector_cargo" placeholder="Cargo (I28)"><br>
    <input type="text" name="inspector_empresa" placeholder="Empresa (O28)"><br>
    <input type="text" name="inspector_dni" placeholder="DNI (T28)"><br>

    <label for="fecha_inicio">Fecha de Inspecci√≥n (F30):</label>
    <input type="date" id="fecha_inicio" name="fecha_inicio" required><br>
    
    <label for="fecha_fin">Fecha fin supervisi√≥n (R30):</label>
    <input type="date" id="fecha_fin" name="fecha_fin"><br>

    <hr>
    
    <h2>IV. PREGUNTAS DE VERIFICACI√ìN DE ESTRUCTURA</h2>
    <p>Respuesta (SI/NO/NA) | Aplica Paralizaci√≥n (SI/NO) | Comentarios</p>

    <h3>CIMENTACI√ìN - CONDICIONES DEL CONCRETO</h3>
    
    <div class="question-row">
        <label class="q-number">1.</label>
        <label class="q-text">Presenta fisuras en el concreto (G34/H34/I34):</label>
        <select name="p_concreto_1" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_concreto_1_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_concreto_1_comentario" placeholder="Comentario (K34)">
    </div>

    <div class="question-row">
        <label class="q-number">2.</label>
        <label class="q-text">Presenta desprendimientos (G35/H35/I35):</label>
        <select name="p_concreto_2" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_concreto_2_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_concreto_2_comentario" placeholder="Comentario (K35)">
    </div>
    
    <div class="question-row">
        <label class="q-number">3.</label>
        <label class="q-text">Presenta humedad (G36/H36/I36):</label>
        <select name="p_concreto_3" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_concreto_3_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_concreto_3_comentario" placeholder="Comentario (K36)">
    </div>

    <h3>CIMENTACI√ìN - ESTADO DE ANCLAJES</h3>
    
    <div class="question-row">
        <label class="q-number">4.</label>
        <label class="q-text">Presenta grouting (G38/H38/I38):</label>
        <select name="p_anclaje_1" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_anclaje_1_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_anclaje_1_comentario" placeholder="Comentario (K38)">
    </div>

    <div class="question-row">
        <label class="q-number">5.</label>
        <label class="q-text">Presenta codo (doblado) (G39/H39/I39):</label>
        <select name="p_anclaje_2" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_anclaje_2_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_anclaje_2_comentario" placeholder="Comentario (K39)">
    </div>

    <div class="question-row">
        <label class="q-number">6.</label>
        <label class="q-text">Presenta tuerca y contra tuerca (G40/H40/I40):</label>
        <select name="p_anclaje_3" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_anclaje_3_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_anclaje_3_comentario" placeholder="Comentario (K40)">
    </div>

    <h3>CIMENTACI√ìN - ESTADO DE PLANCHA BASE</h3>

    <div class="question-row">
        <label class="q-number">7.</label>
        <label class="q-text">Presenta deformaci√≥n (G42/H42/I42):</label>
        <select name="p_base_1" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_base_1_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_base_1_comentario" placeholder="Comentario (K42)">
    </div>
    
    <div class="question-row">
        <label class="q-number">8.</label>
        <label class="q-text">Presenta codo (doblado) (G43/H43/I43):</label>
        <select name="p_base_2" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_base_2_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_base_2_comentario" placeholder="Comentario (K43)">
    </div>

    <div class="question-row">
        <label class="q-number">9.</label>
        <label class="q-text">Presenta fisuras en la plancha (G44/H44/I44):</label>
        <select name="p_base_3" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_base_3_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_base_3_comentario" placeholder="Comentario (K44)">
    </div>

    <h3>ESTRUCTURA MET√ÅLICA - CONEXIONES</h3>

    <div class="question-row">
        <label class="q-number">10.</label>
        <label class="q-text">Presenta pernos faltantes (>30%) (G47/H47/I47):</label>
        <select name="p_conexion_1" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_conexion_1_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_conexion_1_comentario" placeholder="Comentario (K47)">
    </div>
    
    <div class="question-row">
        <label class="q-number">11.</label>
        <label class="q-text">Presenta √≥xido en los pernos (G48/H48/I48):</label>
        <select name="p_conexion_2" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_conexion_2_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_conexion_2_comentario" placeholder="Comentario (K48)">
    </div>

    <div class="question-row">
        <label class="q-number">12.</label>
        <label class="q-text">Presenta tuerca y contra tuerca (G49/H49/I49):</label>
        <select name="p_conexion_3" required><option value="NA">NA</option><option value="SI">SI</option><option value="NO">NO</option></select>
        <select name="p_conexion_3_paralizacion"><option value="NO">NO</option><option value="SI">SI</option></select>
        <input type="text" name="p_conexion_3_comentario" placeholder="Comentario (K49)">
    </div>
    
    <hr>
    
    <h2>V. RESULTADO DE LA INSPECCI√ìN</h2>
    <label>Cantidad de SI/NO (CALCULADO AUTOM√ÅTICAMENTE)</label>
    <input type="text" disabled value="CALCULADO AUTOM√ÅTICAMENTE"><br>
    <label>Cantidad Preguntas Aplicables (CALCULADO AUTOM√ÅTICAMENTE)</label>
    <input type="text" disabled value="CALCULADO AUTOM√ÅTICAMENTE"><br>
    <label>Calificaci√≥n Lograda % (CALCULADO AUTOM√ÅTICAMENTE)</label>
    <input type="text" disabled value="CALCULADO AUTOM√ÅTICAMENTE"><br>

    <hr>

    <h2>Reporte Fotogr√°fico</h2>
    <label for="foto">Adjuntar Foto (Obligatorio):</label>
    <input type="file" id="foto" name="foto" accept="image/*" required><br>
    <input type="text" name="descripcionFoto" placeholder="Descripci√≥n de la foto (B24)">

    <button type="submit" id="btnSubmit">Generar Reporte Excel</button>
    <div id="status-msg"></div>
</form>

<script>
    document.getElementById('reporte-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        const statusDiv = document.getElementById('status-msg');
        const formData = new FormData(e.target);

        if(!formData.get('foto').name) {
            alert("‚ö†Ô∏è Debes subir una foto obligatoriamente.");
            return;
        }

        btn.disabled = true;
        btn.textContent = "‚è≥ Generando Excel...";
        statusDiv.textContent = "Procesando datos...";
        statusDiv.className = "";

        try {
            // üî¥ ¬°IMPORTANTE! REEMPLAZA ESTA URL con la URL de tu backend en Render 
            const URL_BACKEND = "https://backend-reportes-excel.onrender.com/generar-reporte"; 

            const response = await fetch(URL_BACKEND, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error(await response.text());

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reporte_${formData.get('nombre_site') || 'OOCC'}.xlsx`; 
            document.body.appendChild(a);
            a.click();
            a.remove();

            statusDiv.textContent = "‚úÖ ¬°Reporte descargado correctamente!";
            statusDiv.className = "text-success";

        } catch (error) {
            console.error(error);
            statusDiv.textContent = "‚ùå Error: " + error.message;
            statusDiv.className = "text-error";
        } finally {
            btn.disabled = false;
            btn.textContent = "Generar Reporte Excel";
        }
    });
</script>

</body>
</html>