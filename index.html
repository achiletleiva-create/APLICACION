<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte AENOR - Estricto Mapeo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #667eea; --secondary: #764ba2; --success: #27ae60; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, var(--primary), var(--secondary)); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: var(--white); width: 100%; max-width: 950px; padding: 30px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        .slide { display: none; } .slide.active { display: block; }
        h2, h3 { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .inspector-block { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th, td { border: 1px solid #eee; padding: 8px; }
        .buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        button { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-export { background: var(--success); color: white; display: none; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <form id="formReporte">
        <h2>REPORTE TÉCNICO AENOR</h2>

        <div class="slide active">
            <h3>Bloque 1: Cooperador</h3>
            <div class="form-grid">
                <div><label>Razón Social (E11)</label><input type="text" name="E11"></div>
                <div><label>RUC (T11)</label><input type="text" name="T11"></div>
            </div>
            <h4>Personal en Campo</h4>
            <div class="form-grid">
                <div><label>P1 Nombre (D12)</label><input type="text" name="D12"></div>
                <div><label>P1 Cargo (H12)</label><input type="text" name="H12"></div>
                <div><label>P1 Empresa (Q12)</label><input type="text" name="Q12"></div>
                <div><label>P1 DNI (T12)</label><input type="text" name="T12"></div>
            </div>
            <div class="form-grid">
                <div><label>P2 Nombre (D13)</label><input type="text" name="D13"></div>
                <div><label>P2 Cargo (H13)</label><input type="text" name="H13"></div>
                <div><label>P2 Empresa (Q13)</label><input type="text" name="Q13"></div>
                <div><label>P2 DNI (T13)</label><input type="text" name="T13"></div>
            </div>
            </div>

        <div class="slide">
            <h3>Bloque 2: Proyecto y Site</h3>
            <div class="form-grid">
                <div><label>Nombre Site (E20)</label><input type="text" name="E20"></div>
                <div><label>Proyecto (L20)</label><input type="text" name="L20"></div>
                <div><label>Solución (T20)</label><input type="text" name="T20"></div>
            </div>
            <div class="form-grid">
                <div><label>Prioridad (E21)</label><input type="text" name="E21"></div>
                <div><label>Actividad Campo (L21)</label><input type="text" name="L21"></div>
                <div><label>N. MOP (T21)</label><input type="text" name="T21"></div>
            </div>
            <div class="form-grid">
                <div><label>Dirección (E22)</label><input type="text" name="E22"></div>
                <div><label>N. Contrato (T22)</label><input type="text" name="T22"></div>
                <div><label>Distrito (E24)</label><input type="text" name="E24"></div>
            </div>
        </div>

        <div class="slide">
            <h3>Bloque 3: Inspectores</h3>
            <div class="inspector-block">
                <div class="form-grid">
                    <div><label>Ins 1 Nombre (D28)</label><input type="text" name="D28"></div>
                    <div><label>Ins 1 Cargo (H28)</label><input type="text" name="H28"></div>
                    <div><label>Ins 1 Empresa (O28)</label><input type="text" name="O28"></div>
                    <div><label>Ins 1 DNI (T28)</label><input type="text" name="T28"></div>
                </div>
            </div>
            <div class="inspector-block">
                <div class="form-grid">
                    <div><label>Ins 2 Nombre (D29)</label><input type="text" name="D29"></div>
                    <div><label>Ins 2 Cargo (H29)</label><input type="text" name="H29"></div>
                    <div><label>Ins 2 Empresa (O29)</label><input type="text" name="O29"></div>
                    <div><label>Ins 2 DNI (T29)</label><input type="text" name="T29"></div>
                </div>
            </div>
            <div class="form-grid">
                <div><label>F. Inicio (F30)</label><input type="date" name="F30"></div>
                <div><label>F. Fin (R30)</label><input type="date" name="R30"></div>
            </div>
        </div>

        <div class="slide">
            <h3>Bloque 4: Checklist (45 ítems)</h3>
            <div style="overflow-y: auto; max-height: 400px;">
                <table>
                    <thead><tr><th>Ítem</th><th>Estado (G)</th><th>Paraliza (I)</th><th>Obs (K)</th></tr></thead>
                    <tbody id="checklist-tbody"></tbody>
                </table>
            </div>
            <button type="button" class="btn-export" id="btnExportar" onclick="generarExcel()">GENERAR EXCEL</button>
        </div>

        <div class="buttons">
            <button type="button" onclick="changeSlide(-1)">Anterior</button>
            <button type="button" id="btnNext" onclick="changeSlide(1)">Próximo</button>
        </div>
    </form>
</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll(".slide");
    const preguntas = ["Fisuras concreto", "Desprendimientos", "Humedad", "Grouting", "Óxido Anclajes", "Tuerca/Contratuerca", "Deformación Plancha", "Óxido Plancha", "Fisuras Plancha", "Fisuras Soldadura", "Pernos faltantes", "Óxido Pernos", "Conexiones", "Óxido Planchas Conex", "Fisuras Plancha Conex", "Fisuras Soldadura Conex", "Óxido Montantes", "Óxido Diagonales", "Óxido Redundantes", "Óxido Horizontales", "Escaleras", "Línea de vida", "Roldanas", "Soportes", "Corrosión Montantes", "Corrosión Diagonales", "Corrosión Redundantes", "Corrosión Horizontales", "Corrosión Escaleras", "Corrosión Línea Vida", "Corrosión Roldanas", "Corrosión Soportes", "Pintura", "Galvanizado", "Deformación Vertical", "Movimiento Tope", "Tensión Vientos", "Contravientos", "Continuidad LV", "Empozamiento", "Filtraciones", "Limpieza", "Desperdicios", "Vegetación", "Heces"];

    function initChecklist() {
        const tbody = document.getElementById("checklist-tbody");
        preguntas.forEach((p, i) => {
            tbody.innerHTML += `<tr>
                <td>${i+1}. ${p}</td>
                <td><select name="G_P${i+1}"><option value="N/A">N/A</option><option value="SI">SI</option><option value="NO">NO</option></select></td>
                <td><input type="checkbox" name="I_P${i+1}" value="SI"></td>
                <td><input type="text" name="K_P${i+1}"></td>
            </tr>`;
        });
    }

    function changeSlide(n) {
        slides[currentSlide].classList.remove("active");
        currentSlide += n;
        document.getElementById("btnNext").style.display = (currentSlide === slides.length - 1) ? "none" : "block";
        document.getElementById("btnExportar").style.display = (currentSlide === slides.length - 1) ? "block" : "none";
        slides[currentSlide].classList.add("active");
    }

    async function generarExcel() {
        const formData = new FormData(document.getElementById("formReporte"));
        const data = Object.fromEntries(formData.entries());
        const response = await fetch('https://backend-reportes-excel.onrender.com/generar-reporte', {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
        });
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `Reporte_${data.E20 || 'AENOR'}.xlsx`; a.click();
    }
    initChecklist();
</script>
</body>
</html>
